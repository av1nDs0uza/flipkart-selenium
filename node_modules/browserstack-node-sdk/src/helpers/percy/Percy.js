const a61_0x46ad2c=a61_0x5d47;(function(_0x3e134f,_0x5f47be){const _0x12cf12=a61_0x5d47,_0x4f9ae8=_0x3e134f();while(!![]){try{const _0x60e2ef=parseInt(_0x12cf12(0xcd))/0x1+parseInt(_0x12cf12(0xee))/0x2+parseInt(_0x12cf12(0xf8))/0x3*(parseInt(_0x12cf12(0xfd))/0x4)+-parseInt(_0x12cf12(0x110))/0x5*(parseInt(_0x12cf12(0xc2))/0x6)+parseInt(_0x12cf12(0xbf))/0x7*(-parseInt(_0x12cf12(0xf5))/0x8)+parseInt(_0x12cf12(0x107))/0x9+-parseInt(_0x12cf12(0xea))/0xa;if(_0x60e2ef===_0x5f47be)break;else _0x4f9ae8['push'](_0x4f9ae8['shift']());}catch(_0x33d810){_0x4f9ae8['push'](_0x4f9ae8['shift']());}}}(a61_0x9c6d,0x432ea));const fs=require('fs'),path=require(a61_0x46ad2c(0x101)),os=require('os'),{spawn}=require(a61_0x46ad2c(0xc1)),helper=require('../helper'),logger=require(a61_0x46ad2c(0x10d))[a61_0x46ad2c(0xb2)],{logDir}=require(a61_0x46ad2c(0x10d)),PercyBinary=require(a61_0x46ad2c(0xc6));class Percy{#logfile=path[a61_0x46ad2c(0xd5)](logDir,'percy.log');#address=process['env'][a61_0x46ad2c(0xd6)]||a61_0x46ad2c(0x114);#binaryPath=null;#config=null;#proc=null;#isApp=![];[a61_0x46ad2c(0xf3)]=![];constructor(_0x163e10){const _0x33daa7=a61_0x46ad2c,_0x17f14c={'PMeIa':function(_0x47a8d8,_0x134f88){return _0x47a8d8(_0x134f88);},'yZVJC':function(_0x3c259b,_0x1b518f){return _0x3c259b===_0x1b518f;},'RWLlZ':'mTVVO'};this.#config=_0x163e10,!!_0x163e10[_0x33daa7(0xb1)]&&(_0x17f14c['yZVJC'](_0x17f14c[_0x33daa7(0xf2)],_0x17f14c[_0x33daa7(0xf2)])?this.#isApp=!![]:(_0x26ba37['error'](_0x33daa7(0xdf)+_0x47d948),_0x17f14c[_0x33daa7(0xb9)](_0x4ab9a5,null)));}async #getBinaryPath(){const _0x3ca83f=a61_0x46ad2c,_0x41e96d={'Eoxnl':function(_0x299901,_0x31172d){return _0x299901(_0x31172d);},'rAgsr':function(_0x5b3c83,_0x55e525){return _0x5b3c83+_0x55e525;},'kqjqB':_0x3ca83f(0xad),'EoUmT':function(_0x4729f5,_0x379e38){return _0x4729f5(_0x379e38);},'UoMSm':function(_0x58cab6,_0x4164cd){return _0x58cab6!==_0x4164cd;},'rkHms':_0x3ca83f(0xe4),'ZETSa':_0x3ca83f(0xe8)};if(!this.#binaryPath){if(_0x41e96d['UoMSm'](_0x41e96d['rkHms'],_0x41e96d['ZETSa'])){const _0x3670bb=new PercyBinary();this.#binaryPath=await _0x3670bb['getBinaryPath'](this.#config);}else _0x182e2c&&(_0x3816fa[_0x3ca83f(0xc3)](_0x3ca83f(0xdf)+_0x55a3ef),_0x41e96d['Eoxnl'](_0x1ebc39,null)),_0x3d8b1c[_0x3ca83f(0xf6)](_0x41e96d[_0x3ca83f(0xbc)](_0x41e96d[_0x3ca83f(0xa6)],_0x1d4b54)),_0x41e96d['EoUmT'](_0x404895,_0x45d830);}return this.#binaryPath;}async #sleep(_0x4be710){return new Promise(_0x315db3=>setTimeout(_0x315db3,_0x4be710));}async[a61_0x46ad2c(0xfb)](){const _0x5e7de1=a61_0x46ad2c,_0x3e7421={};_0x3e7421[_0x5e7de1(0xe0)]=function(_0x764ce1,_0x1cbeb9){return _0x764ce1===_0x1cbeb9;},_0x3e7421[_0x5e7de1(0xd8)]=_0x5e7de1(0xcf),_0x3e7421[_0x5e7de1(0xc4)]=_0x5e7de1(0xaf),_0x3e7421[_0x5e7de1(0xdc)]=_0x5e7de1(0xf0),_0x3e7421[_0x5e7de1(0x11a)]=function(_0x3667f9,_0x813d55){return _0x3667f9!==_0x813d55;},_0x3e7421[_0x5e7de1(0x104)]=_0x5e7de1(0xcc),_0x3e7421['rVFup']='YmRLc',_0x3e7421[_0x5e7de1(0xda)]=function(_0xddf421,_0x474f96){return _0xddf421!==_0x474f96;},_0x3e7421['RWrPq']=_0x5e7de1(0xa8),_0x3e7421[_0x5e7de1(0xd0)]=_0x5e7de1(0xfc);const _0x5af1ca=_0x3e7421;try{if(_0x5af1ca['ZjKMX'](_0x5af1ca[_0x5e7de1(0xd8)],_0x5af1ca[_0x5e7de1(0xd8)])){const _0x64358d=await helper['nodeRequest'](_0x5af1ca['sVlrW'],_0x5af1ca[_0x5e7de1(0xdc)],null,null,this.#address);if(_0x64358d){if(_0x5af1ca[_0x5e7de1(0x11a)](_0x5af1ca[_0x5e7de1(0x104)],_0x5af1ca['rVFup']))return!![];else _0x4ab792['isProcessRunning']=![];}}else return null;}catch(_0x42dc03){if(_0x5af1ca[_0x5e7de1(0xda)](_0x5af1ca[_0x5e7de1(0xbe)],_0x5af1ca[_0x5e7de1(0xd0)]))return![];else _0x59ec72[_0x5e7de1(0xbd)]('-c',_0xb7182d);}}async['start'](){const _0x530d79=a61_0x46ad2c,_0x54c4f1={'aOQTr':_0x530d79(0x10f),'QWfhU':function(_0x9d3c6d,_0x521aef){return _0x9d3c6d!==_0x521aef;},'bgbTO':_0x530d79(0xa2),'QJFHk':_0x530d79(0xff),'gfbTf':function(_0x1f1293,_0xec88d7){return _0x1f1293===_0xec88d7;},'kEPug':_0x530d79(0xac),'vTcIF':_0x530d79(0xb3),'aizbq':'app:exec','lppdN':_0x530d79(0xdd),'kEwgk':function(_0x8f9a92,_0x38cb20){return _0x8f9a92===_0x38cb20;},'YWvpd':_0x530d79(0xb5),'wiqAy':'obpxX','acKrB':function(_0x321adb,_0x3c4168,_0x182848,_0x2977c2){return _0x321adb(_0x3c4168,_0x182848,_0x2977c2);},'ogxTU':_0x530d79(0xce),'xUrqB':_0x530d79(0xeb),'HvSXQ':_0x530d79(0xb6),'QzyVi':function(_0x67fc0d,_0x40f213){return _0x67fc0d!==_0x40f213;},'PpBYG':_0x530d79(0xf7)},_0x310816=await this.#getBinaryPath(),_0x24c4d2={};_0x24c4d2['flags']='a';const _0x52755a=fs[_0x530d79(0x115)](this.#logfile,_0x24c4d2),_0x13f6fb=await this['fetchPercyToken'](),_0x383016=await this['createPercyConfig']();if(!_0x13f6fb)return _0x54c4f1[_0x530d79(0xf9)](_0x54c4f1[_0x530d79(0xef)],_0x54c4f1[_0x530d79(0xae)])?![]:![];const _0x13543a=[(this.#isApp?_0x54c4f1['aizbq']:_0x54c4f1['lppdN'])+_0x530d79(0xa5)];if(_0x383016){if(_0x54c4f1[_0x530d79(0x10e)](_0x54c4f1['YWvpd'],_0x54c4f1[_0x530d79(0xa3)]))return new _0x56f1e0(_0x18d20a=>_0x6adc8a(_0x18d20a,_0x1a81d8));else _0x13543a['push']('-c',_0x383016);}const _0x28e3f7={};_0x28e3f7['PERCY_TOKEN']=_0x13f6fb,this.#proc=_0x54c4f1[_0x530d79(0x113)](spawn,_0x310816,_0x13543a,{'env':Object['assign'](process[_0x530d79(0xa9)],_0x28e3f7)}),this.#proc['stdout'][_0x530d79(0xb0)](_0x52755a),this.#proc[_0x530d79(0xe6)]['pipe'](_0x52755a),this[_0x530d79(0xf3)]=!![];var _0x56df1a=this;this.#proc['on'](_0x54c4f1['ogxTU'],function(_0x2ba62d){const _0x22917a=_0x530d79;if(_0x54c4f1[_0x22917a(0x108)](_0x54c4f1['bgbTO'],_0x54c4f1[_0x22917a(0xde)]))_0x56df1a[_0x22917a(0xf3)]=![];else return _0x3d30f2[_0x22917a(0xf6)](_0x54c4f1[_0x22917a(0x118)]),!![];});do{if(_0x54c4f1['QWfhU'](_0x54c4f1[_0x530d79(0xc8)],_0x54c4f1[_0x530d79(0xc5)])){const _0x1a2a23=await this[_0x530d79(0xfb)]();if(_0x1a2a23)return _0x54c4f1[_0x530d79(0xba)](_0x54c4f1['PpBYG'],_0x54c4f1[_0x530d79(0xd1)])?(_0x170754[_0x530d79(0xc3)](_0x530d79(0xb4)+_0x4da3fd),null):(logger[_0x530d79(0xf6)](_0x54c4f1['aOQTr']),!![]);await this.#sleep(0x3e8);}else return!![];}while(this['isProcessRunning']);return![];}async['stop'](){const _0x2686cd=a61_0x46ad2c,_0x51ef1d={'sAfQH':function(_0x47e985,_0x21be08){return _0x47e985===_0x21be08;},'uzXUp':'iFBSf','yiJVg':function(_0x5e2df3,_0x66c362){return _0x5e2df3(_0x66c362);},'JKgoI':function(_0x51fa24,_0x447cfd){return _0x51fa24!==_0x447cfd;},'PKfEx':'HvBpa','sosLd':_0x2686cd(0xaa),'MvdhH':function(_0x15ebe1,_0x3f2f1c,_0x16be68){return _0x15ebe1(_0x3f2f1c,_0x16be68);},'zxfxO':_0x2686cd(0xd4),'roDZX':_0x2686cd(0xce)},_0x10ad20=await this.#getBinaryPath();return new Promise((_0x70f855,_0x3a8f8e)=>{const _0xad8e7a=_0x2686cd,_0x12625d={'vRRxI':function(_0x40a3dc,_0x2494ed){const _0x34657b=a61_0x5d47;return _0x51ef1d[_0x34657b(0x117)](_0x40a3dc,_0x2494ed);},'IxUeo':_0x51ef1d[_0xad8e7a(0x11b)],'WhwHY':function(_0x302b70,_0x5c809d){const _0x45325b=_0xad8e7a;return _0x51ef1d[_0x45325b(0xf4)](_0x302b70,_0x5c809d);}};if(_0x51ef1d[_0xad8e7a(0xcb)](_0x51ef1d[_0xad8e7a(0xe5)],_0x51ef1d[_0xad8e7a(0xc0)])){const _0x58e0ed=_0x51ef1d[_0xad8e7a(0xab)](spawn,_0x10ad20,[_0x51ef1d[_0xad8e7a(0x105)]]);_0x58e0ed['on'](_0x51ef1d[_0xad8e7a(0x111)],_0x1b92db=>{const _0x155ab9=_0xad8e7a;_0x12625d[_0x155ab9(0xd3)](_0x12625d['IxUeo'],_0x12625d[_0x155ab9(0x116)])?(this['isProcessRunning']=![],_0x12625d[_0x155ab9(0xed)](_0x70f855,_0x1b92db)):_0xc2bb21['version']='2';});}else return this[_0xad8e7a(0xf3)];});}['isRunning'](){const _0x17dfdf=a61_0x46ad2c;return this[_0x17dfdf(0xf3)];}async['fetchPercyToken'](){const _0x46b537=a61_0x46ad2c,_0x29664a={'xONpu':function(_0x224da1,_0x21bea3){return _0x224da1(_0x21bea3);},'pyhtf':function(_0x1fa5fe,_0xfd8ad,_0xdc78f2){return _0x1fa5fe(_0xfd8ad,_0xdc78f2);},'xJCBV':'exec:stop','nDjFE':'close','HyjuA':function(_0x5e3267,_0x448891){return _0x5e3267===_0x448891;},'rZnUW':'lUiRy','mbYlu':_0x46b537(0xb1),'mhazj':_0x46b537(0x119),'lubFA':_0x46b537(0xaf),'IogfE':'Percy\x20fetch\x20token\x20success','sUdPp':'bTyeC'},_0x1b7e4a=this.#config[_0x46b537(0xca)];try{if(_0x29664a[_0x46b537(0xf1)](_0x29664a[_0x46b537(0xe7)],_0x29664a[_0x46b537(0xe7)])){const _0x18a1ad=this.#isApp?_0x29664a[_0x46b537(0x106)]:_0x29664a['mhazj'],_0x4baf9c=await helper[_0x46b537(0xc9)](_0x29664a[_0x46b537(0xb7)],_0x46b537(0x103)+_0x1b7e4a+'&type='+_0x18a1ad,{},this.#config),_0x18c57b=_0x4baf9c['data'];return logger[_0x46b537(0xf6)](_0x29664a[_0x46b537(0xd2)]),_0x18c57b['token'];}else{const _0x27d28d=_0x29664a[_0x46b537(0x112)](_0x1ce0dd,_0x19b2c6,[_0x29664a[_0x46b537(0xfe)]]);_0x27d28d['on'](_0x29664a[_0x46b537(0xd7)],_0x4473f4=>{const _0x9188da=_0x46b537;this[_0x9188da(0xf3)]=![],_0x29664a[_0x9188da(0xe3)](_0x4874f2,_0x4473f4);});}}catch(_0xa2ba50){if(_0x29664a[_0x46b537(0xf1)](_0x29664a[_0x46b537(0x10c)],_0x29664a['sUdPp']))return logger[_0x46b537(0xc3)](_0x46b537(0xb4)+_0xa2ba50),null;else this[_0x46b537(0xf3)]=![],_0x29664a[_0x46b537(0xe3)](_0x45e2aa,_0x5601d7);}}async[a61_0x46ad2c(0xd9)](){const _0x57a029=a61_0x46ad2c,_0x5489d3={'NSgDw':function(_0x1b1151,_0x54fdb5){return _0x1b1151(_0x54fdb5);},'iplaV':function(_0x19d9b0,_0x4e1787){return _0x19d9b0+_0x4e1787;},'nllbP':_0x57a029(0xad),'bNhKJ':function(_0x33d6b2,_0x3a774d){return _0x33d6b2(_0x3a774d);},'ojFem':function(_0x589b9a,_0x146dd4){return _0x589b9a(_0x146dd4);},'VIfSt':function(_0x5ba1ab,_0x264c36){return _0x5ba1ab+_0x264c36;},'agwBf':function(_0x84ca06,_0x2b362b){return _0x84ca06!==_0x2b362b;},'SNdcw':_0x57a029(0x102),'KlpEb':_0x57a029(0xdb),'oCjLJ':_0x57a029(0xe1)};if(!this.#config[_0x57a029(0xec)]){if(_0x5489d3[_0x57a029(0xbb)](_0x5489d3[_0x57a029(0x10a)],_0x5489d3['SNdcw']))_0x26ebe2[_0x57a029(0xa7)](_0x860bd1,_0x5a82c6[_0x57a029(0xfa)](_0x395def),_0x8f08cf=>{const _0x232786=_0x57a029;_0x8f08cf&&(_0xfa4e2b[_0x232786(0xc3)](_0x232786(0xdf)+_0x8f08cf),_0x5489d3[_0x232786(0xc7)](_0x32f1db,null)),_0x565d4b[_0x232786(0xf6)](_0x5489d3[_0x232786(0xb8)](_0x5489d3[_0x232786(0x109)],_0xba6cb)),_0x5489d3['bNhKJ'](_0x1c19cf,_0x4f06b9);});else return null;}const _0x240741=path['join'](os[_0x57a029(0xe9)](),_0x5489d3['KlpEb']),_0x34537f=this.#config[_0x57a029(0xec)];if(!_0x34537f['version']){if(_0x5489d3['agwBf'](_0x5489d3['oCjLJ'],_0x5489d3[_0x57a029(0xe2)]))return![];else _0x34537f[_0x57a029(0x100)]='2';}return new Promise((_0x26b828,_0x1be510)=>{const _0x302779=_0x57a029,_0x322640={'JNGkp':function(_0xf386c2,_0xfa773){return _0x5489d3['ojFem'](_0xf386c2,_0xfa773);},'luvkw':function(_0x5f0006,_0x3b399b){const _0x38b3d0=a61_0x5d47;return _0x5489d3[_0x38b3d0(0xa4)](_0x5f0006,_0x3b399b);},'jsuXr':_0x5489d3[_0x302779(0x109)]};fs['writeFile'](_0x240741,JSON[_0x302779(0xfa)](_0x34537f),_0x1e967f=>{const _0x337142=_0x302779;_0x1e967f&&(logger[_0x337142(0xc3)](_0x337142(0xdf)+_0x1e967f),_0x322640['JNGkp'](_0x26b828,null)),logger[_0x337142(0xf6)](_0x322640['luvkw'](_0x322640['jsuXr'],_0x240741)),_0x322640[_0x337142(0x10b)](_0x26b828,_0x240741);});});}}function a61_0x9c6d(){const _0x4e2076=['nllbP','SNdcw','JNGkp','sUdPp','../logger','kEwgk','Percy\x20healthcheck\x20successful','809370iCBmep','roDZX','pyhtf','acKrB','http://localhost:5338','createWriteStream','IxUeo','sAfQH','aOQTr','automate','zyLXZ','uzXUp','zmJsw','wiqAy','VIfSt',':start','kqjqB','writeFile','pXcXD','env','InWXT','MvdhH','pjAen','Percy\x20config\x20created\x20at\x20','vTcIF','GET','pipe','app','winstonLogger','LKhqX','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','YNHhp','tAVpK','lubFA','iplaV','PMeIa','QzyVi','agwBf','rAgsr','push','RWrPq','14xWelMw','sosLd','child_process','18GRYYcG','error','sVlrW','HvSXQ','./PercyBinary','NSgDw','xUrqB','nodeRequest','projectName','JKgoI','WeCWq','50910NKoBuK','close','gNxyv','CxnJQ','PpBYG','IogfE','vRRxI','exec:stop','join','PERCY_SERVER_ADDRESS','nDjFE','YHCmD','createPercyConfig','pIdQV','percy.json','xSdHB','exec','QJFHk','Error\x20creating\x20percy\x20config:\x20','ZjKMX','kSbmM','oCjLJ','xONpu','syKxI','PKfEx','stderr','rZnUW','ZvhYi','tmpdir','2211040brXKTf','KjFPX','percyOptions','WhwHY','1009160mNKIss','kEPug','percy/healthcheck','HyjuA','RWLlZ','isProcessRunning','yiJVg','1613456PqJawq','debug','EDDuA','15069KqadnQ','gfbTf','stringify','healthcheck','tTYCZ','236weaDqr','xJCBV','iTZVi','version','path','lmYAk','api/app_percy/get_project_token?name=','wStyN','zxfxO','mbYlu','4800789MdnFQK','QWfhU'];a61_0x9c6d=function(){return _0x4e2076;};return a61_0x9c6d();}function a61_0x5d47(_0x4b8d9e,_0x2e5aa5){const _0x9c6d7e=a61_0x9c6d();return a61_0x5d47=function(_0x5d473b,_0xcc5d91){_0x5d473b=_0x5d473b-0xa2;let _0x3b2ef0=_0x9c6d7e[_0x5d473b];return _0x3b2ef0;},a61_0x5d47(_0x4b8d9e,_0x2e5aa5);}module['exports']=Percy;